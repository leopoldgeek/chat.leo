<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  background: url("https://i.ibb.co/zhhp9ZDw/Chat-GPT-Image-3-f-vr-2026-14-31-22.png") no-repeat center center fixed;
  background-size: 5 000,500 pt;
}
h1,h2{text-align:center;text-shadow:0 0 8px #0f0}
input,textarea,button,select{
  margin:6px;padding:10px;background:#ff0000;color:#0f0;
  border:1px solid #0f0;border-radius:6px
}
button.spyBtn{
  min-width:160px;padding:12px 20px;background:8#0979;
  color:#0f0;border:2px solid #0f0;border-radius:8px;cursor:pointer
}
button.spyBtn:hover{background:#0f0;color:8#0979}
.row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
.hidden{display:none}
.message{border-bottom:1px dashed #0f0;padding:8px}
img{max-width:100%;margin-top:6px;border:1px solid #0f0}
#messagesPanel{max-height:65vh;overflow:auto;padding:10px;border:1px solid #0f0}
small.muted{color:#8f8}
  /* ===== BACKGROUND ESPION ===== */

#spy-bg {
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  overflow: hidden;
}

/* Grille radar */
.grid {
  position: absolute;
  width: 200%;
  height: 200%;
  background:
    linear-gradient(rgba(11, 240, 11, 0.133) 1px, transparent 1px),
    linear-gradient(90deg, rgba(8, 207, 8, 0.133) 1px, transparent 1px);
  background-size: 40px 40px;
  animation: gridMove 20s linear infinite;
}

@keyframes gridMove {
  from { transform: translate(0,0); }
  to   { transform: translate(-40px,-40px); }
}

/* Ligne de scan */
.scanline {
  position: absolute;
  width: 100%;
  height: 2px;
  background: linear-gradient(to right, transparent, #0f0, transparent);
  top: 0;
  animation: scan 6s linear infinite;
  opacity: 0.6;
}

@keyframes scan {
  0% { top: 0; }
  100% { top: 100%; }
}

/* Pluie de caractÃ¨res */
.matrix {
  position: absolute;
  width: 100%;
  height: 100%;
  background-image:
    repeating-linear-gradient(
      to bottom,
      rgba(247, 4, 4, 0.08) 0px,
      rgba(247, 12, 12, 0.08) 1px,
      transparent 2px,
      transparent 6px
    );
  animation: matrixFlicker 0.15s infinite alternate;
}

@keyframes matrixFlicker {
  from { opacity: 0.25; }
  to   { opacity: 0.4; }
}

</style>
</head>

<body>
  <div id="spy-bg">
  <div class="grid"></div>
  <div class="scanline"></div>
  <div class="matrix"></div>
</div>
<h1>ğŸ•µï¸ Espion Supabase</h1>

<!-- Choix -->
<div id="choicePanel" class="row">
  <button class="spyBtn" id="btnChooseAdmin">ğŸ” Admin</button>
  <button class="spyBtn" id="btnChooseUser">ğŸ‘¤ Utilisateur</button>
</div>

<!-- Login -->
<div id="loginPanel" class="hidden">
  <h2 id="loginTitle"></h2>
  <input id="loginId" placeholder="Identifiant">
  <input id="loginPwd" type="password" placeholder="Mot de passe">
  <p id="captchaQuestion"></p>
  <input id="captchaAnswer" placeholder="CAPTCHA">
  <button class="spyBtn" id="btnLogin">Connexion</button>
  <p id="loginError"></p>
  <button class="spyBtn" id="btnBackLogin">â¬… Retour</button>
</div>

<!-- Portail -->
<div id="portalPanel" class="hidden">
  <h2>Centre de contrÃ´le</h2>
  <p style="text-align:center">
    Bienvenue <span id="userName"></span>
    <small id="userRole" class="muted"></small>
  </p>
  <div class="row">
    <button class="spyBtn" id="btnMessages">ğŸ“¥ Messages</button>
    <button class="spyBtn" id="btnGestion">ğŸ” Comptes</button>
    <button class="spyBtn" id="btnEnvoi">ğŸ“¤ Envoyer</button>
    <button class="spyBtn" id="btnLogout">ğŸšª Quitter</button>
  </div>
</div>

<!-- Messages -->
<div id="messagesPanel" class="hidden">
  <h2>ğŸ“¥ Messages</h2>
  <div id="messages"></div>
  <button class="spyBtn btnBack">â¬… Retour</button>
</div>

<!-- Gestion -->
<div id="gestionPanel" class="hidden">
  <h2>ğŸ” Gestion des comptes</h2>

  <input id="newId" placeholder="Identifiant">
  <input id="newPwd" placeholder="Mot de passe">
  <select id="newRole">
    <option value="user">Utilisateur</option>
    <option value="admin">Admin</option>
  </select>
  <button class="spyBtn" id="btnCreate">CrÃ©er</button>

  <hr>

  <select id="accountList" size="6" style="min-width:220px"></select>
  <br>
  <button class="spyBtn" id="btnVoir">ğŸ‘ Voir ID/MDP</button>
  <button class="spyBtn" id="btnBlock">Bloquer / DÃ©bloquer</button>
  <button class="spyBtn" id="btnDelete">Supprimer</button>

  <br>
  <button class="spyBtn btnBack">â¬… Retour</button>
</div>

<!-- Envoi -->
<div id="envoiPanel" class="hidden">
  <h2>ğŸ“¤ Envoyer</h2>
  <textarea id="msgText" rows="4" placeholder="Message"></textarea>

  <div id="destList" style="border:1px solid #0f0;padding:8px;max-height:150px;overflow:auto"></div>

  <input type="file" id="imageInput" accept="image/*">
  <img id="preview" style="display:none">

  <button class="spyBtn" id="btnSend">Envoyer</button>
  <p id="sendStatus"></p>
  <button class="spyBtn btnBack">â¬… Retour</button>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const supabase = createClient(
  "https://vuymduxdvemtcbbzdqml.supabase.co",
  "sb_publishable_6jCj8B1gHh5v6teJe-zy0g_rf1ijiYJ"
);

const el=id=>document.getElementById(id);
const show=id=>{
 ["choicePanel","loginPanel","portalPanel","messagesPanel","gestionPanel","envoiPanel"]
 .forEach(p=>el(p).classList.add("hidden"));
 el(id).classList.remove("hidden");
};

let user=null, role=null, roleChoice=null, a=0,b=0;

function captcha(){
 a=Math.floor(Math.random()*10)+1;
 b=Math.floor(Math.random()*10)+1;
 el("captchaQuestion").textContent=`${a} + ${b} = ?`;
}

el("btnChooseAdmin").onclick=()=>{roleChoice="admin";el("loginTitle").textContent="Connexion Admin";captcha();show("loginPanel")};
el("btnChooseUser").onclick=()=>{roleChoice="user";el("loginTitle").textContent="Connexion User";captcha();show("loginPanel")};
el("btnBackLogin").onclick=()=>show("choicePanel");

el("btnLogin").onclick=async()=>{
 if(parseInt(el("captchaAnswer").value)!==(a+b)) return captcha();

 const {data,error}=await supabase.from("comptes")
 .select("*")
 .eq("identifiant",el("loginId").value)
 .eq("motdepasse",el("loginPwd").value)
 .eq("bloque",false)
 .single();

 if(error||!data|| (roleChoice==="admin"&&data.role!=="admin")){
   el("loginError").textContent="AccÃ¨s refusÃ©";
   return;
 }

 user=data.identifiant;
 role=data.role;
 el("userName").textContent=user;
 el("userRole").textContent=`(${role})`;
 show("portalPanel");
};

el("btnLogout").onclick=()=>{user=null;role=null;show("choicePanel")};

el("btnMessages").onclick=async()=>{
 show("messagesPanel");
 el("messages").innerHTML="";
 const {data}=await supabase.from("messages").select("*").order("created_at",{ascending:false});
 data.forEach(m=>{
  if(m.auteur!==user && !m.destinataires.includes(user) && role!=="admin") return;
  const d=document.createElement("div");
  d.className="message";
  d.innerHTML=`<b>${m.auteur}</b>: ${m.texte}`;
  if(m.image){const i=document.createElement("img");i.src=m.image;d.appendChild(i);}
  el("messages").appendChild(d);
 });
};

el("btnGestion").onclick=async()=>{
 if(role!=="admin")return;
 show("gestionPanel");
 loadAccounts();
};

async function loadAccounts(){
 el("accountList").innerHTML="";
 const {data}=await supabase.from("comptes").select("*");
 data.forEach(c=>{
  const o=document.createElement("option");
  o.value=c.id;
  o.textContent=`${c.identifiant} [${c.role}] ${c.bloque?"(bloquÃ©)":""}`;
  el("accountList").appendChild(o);
 });
}

el("btnCreate").onclick=async()=>{
 await supabase.from("comptes").insert({
  identifiant:el("newId").value,
  motdepasse:el("newPwd").value,
  role:el("newRole").value,
  bloque:false
 });
 loadAccounts();
};

el("btnDelete").onclick=async()=>{
 await supabase.from("comptes").delete().eq("id",el("accountList").value);
 loadAccounts();
};

el("btnBlock").onclick=async()=>{
 const {data}=await supabase.from("comptes").select("bloque").eq("id",el("accountList").value).single();
 await supabase.from("comptes").update({bloque:!data.bloque}).eq("id",el("accountList").value);
 loadAccounts();
};

el("btnVoir").onclick=async()=>{
 const {data}=await supabase.from("comptes")
 .select("identifiant,motdepasse")
 .eq("id",el("accountList").value)
 .single();
 alert(`ID: ${data.identifiant}\nMDP: ${data.motdepasse}`);
};

el("btnEnvoi").onclick=async()=>{
 show("envoiPanel");
 el("destList").innerHTML="";
 const {data}=await supabase.from("comptes").select("identifiant,bloque");
 data.forEach(c=>{
  if(c.bloque)return;
  const l=document.createElement("label");
  l.innerHTML=`<input type="checkbox" value="${c.identifiant}"> ${c.identifiant}`;
  el("destList").appendChild(l);
 });
};

el("btnSend").onclick=async()=>{
 const dest=[...el("destList").querySelectorAll("input:checked")].map(c=>c.value);
 if(dest.length===0)return;
 await supabase.from("messages").insert({
  auteur:user,
  texte:el("msgText").value,
  image:el("preview").src||null,
  destinataires:dest
 });
 el("msgText").value="";
};

document.querySelectorAll(".btnBack").forEach(b=>b.onclick=()=>show("portalPanel"));
</script>
</body>
</html>







